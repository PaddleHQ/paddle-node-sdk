/**
 *  ! Autogenerated code !
 *  Do not make changes to this file.
 *  Changes may be overwritten as part of auto-generation.
 */

import {
  CreateSimulationRequestBody,
  ListSimulationQueryParameters,
  SimulationsResource,
  UpdateSimulationRequestBody,
} from '../../resources/index.js';
import { getPaddleTestClient } from '../helpers/test-client.js';
import {
  CreateSimulationMock,
  CreateSimulationScenarioMock,
  CreateSimulationScenarioMockResponse,
  ListSimulationMockResponse,
  SimulationMock,
  SimulationMockResponse,
  updateSimulationMock,
} from '../mocks/resources/simulations.mock.js';

describe('SimulationsResource', () => {
  test('should return a list of simulations', async () => {
    const paddleInstance = getPaddleTestClient();
    paddleInstance.get = jest.fn().mockResolvedValue(ListSimulationMockResponse);

    const simulationsResource = new SimulationsResource(paddleInstance);
    const simulationCollection = simulationsResource.list();

    let simulations = await simulationCollection.next();
    expect(paddleInstance.get).toHaveBeenCalledWith('/simulations?');
    expect(simulations.length).toBe(1);

    simulations = await simulationCollection.next();
    expect(paddleInstance.get).toHaveBeenCalledWith('/simulations?after=1');
    expect(simulations.length).toBe(1);
  });

  test('should accept query params and return a list of simulations', async () => {
    const paddleInstance = getPaddleTestClient();
    paddleInstance.get = jest.fn().mockResolvedValue(ListSimulationMockResponse);
    const simulationsResource = new SimulationsResource(paddleInstance);
    const queryParams: ListSimulationQueryParameters = {
      after: '2',
      id: ['1234'],
    };

    const simulationCollection = simulationsResource.list(queryParams);
    const simulations = await simulationCollection.next();

    expect(paddleInstance.get).toHaveBeenCalledWith('/simulations?after=2&id=1234');
    expect(simulations.length).toBe(1);
  });

  test('should return a single simulation by ID', async () => {
    const simulationId = SimulationMock.id;
    const paddleInstance = getPaddleTestClient();
    paddleInstance.get = jest.fn().mockResolvedValue(SimulationMockResponse);

    const simulationsResource = new SimulationsResource(paddleInstance);
    const simulation = await simulationsResource.get(simulationId);

    expect(paddleInstance.get).toHaveBeenCalledWith(`/simulations/${simulationId}`);
    expect(simulation).toBeDefined();
    expect(simulation.id).toBe(simulationId);
  });

  test('should accepts query params and return a single simulation by ID', async () => {
    const simulationId = SimulationMock.id;
    const paddleInstance = getPaddleTestClient();

    paddleInstance.get = jest.fn().mockResolvedValue(SimulationMockResponse);
    const simulationsResource = new SimulationsResource(paddleInstance);

    const simulation = await simulationsResource.get(simulationId);

    expect(simulation).toBeDefined();
    expect(paddleInstance.get).toHaveBeenCalledWith(`/simulations/${simulationId}`);
    expect(simulation.id).toBe(simulationId);
  });

  test('should create a new simulation', async () => {
    const newSimulation: CreateSimulationRequestBody = CreateSimulationMock;
    const paddleInstance = getPaddleTestClient();

    paddleInstance.post = jest.fn().mockResolvedValue(SimulationMockResponse);
    const simulationsResource = new SimulationsResource(paddleInstance);
    const createdSimulation = await simulationsResource.create(newSimulation);

    expect(paddleInstance.post).toHaveBeenCalledWith(`/simulations`, newSimulation);
    expect(createdSimulation).toBeDefined();
    expect(createdSimulation.id).toBeDefined();
    expect(createdSimulation.name).toBe(newSimulation.name);
  });

  test('should update an existing simulation', async () => {
    const simulationId = SimulationMock.id;
    const simulationToBeUpdated: UpdateSimulationRequestBody = updateSimulationMock;

    const paddleInstance = getPaddleTestClient();
    paddleInstance.patch = jest.fn().mockResolvedValue(SimulationMockResponse);

    const simulationsResource = new SimulationsResource(paddleInstance);
    const updatedSimulation = await simulationsResource.update(simulationId, simulationToBeUpdated);

    expect(paddleInstance.patch).toHaveBeenCalledWith(`/simulations/${simulationId}`, simulationToBeUpdated);
    expect(updatedSimulation).toBeDefined();
  });

  test('should create a new simulation scenario', async () => {
    const newSimulationScenario: CreateSimulationRequestBody = CreateSimulationScenarioMock;
    const paddleInstance = getPaddleTestClient();

    paddleInstance.post = jest.fn().mockResolvedValue(CreateSimulationScenarioMockResponse);
    const simulationsResource = new SimulationsResource(paddleInstance);
    const createdSimulation = await simulationsResource.create(newSimulationScenario);

    expect(paddleInstance.post).toHaveBeenCalledWith(`/simulations`, newSimulationScenario);
    expect(createdSimulation).toBeDefined();
    expect(createdSimulation.id).toBeDefined();
    expect(createdSimulation.name).toBe(newSimulationScenario.name);
  });
});
